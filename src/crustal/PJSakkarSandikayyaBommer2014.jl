

function PJSasb2014pga(M::U, R::U, Fnm::Int64, Frv::Int64, Rtype::String="Rjb") where U<:Real
    # distance-type independent coefficients
    a2 = 0.0029
    a5 = 0.2529
    a6 = 7.5
    a7 = -0.5096
    c1 = 6.75
    if Rtype == "Rjb"
        a1 = 1.85329
        a3 = -0.02807
        a4 = -1.23452
        a8 = -0.1091
        a9 = 0.0937
    elseif Rtype == "Repi"
        a1 = 2.52977
        a3 = -0.05496
        a4 = -1.31001
        a8 = -0.1091
        a9 = 0.0937
    elseif Rtype == "Rhyp"
        a1 = 3.26685
        a3 = -0.04846
        a4 = -1.47905
        a8 = -0.1091
        a9 = 0.0937
    else
        print("PJS Error: Rtype must be one of 'Rjb', 'Repi' or 'Rhyp'")
        return NaN
    end

    # reference pga
    if M <= c1
        lnPGA = a1 + a2*(M-c1) + a3*(8.5-M)^2 + (a4 + a5*(M-c1))*log(sqrt( R^2 + a6^2 )) + a8*Fnm + a9*Frv
    else
        lnPGA = a1 + a7*(M-c1) + a3*(8.5-M)^2 + (a4 + a5*(M-c1))*log(sqrt( R^2 + a6^2 )) + a8*Fnm + a9*Frv
    end
    return exp(lnPGA)
end


function PJSasb2014(T::U, M::U, R::U, Vs30::U, Fnm::Int64, Frv::Int64, Rtype::String="Rjb") where U<:Real

	if T > 4.0
		return PJSgroundMotion(NaN, NaN, NaN, NaN, NaN)
	end

    # define the common period vector
    Ti = [ -1.0, 0.0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.22, 0.24, 0.26, 0.28, 0.3, 0.32, 0.34, 0.36, 0.38, 0.4, 0.42, 0.44, 0.46, 0.48, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.2, 2.4, 2.6, 2.8, 3.0, 3.2, 3.4, 3.6, 3.8, 4.0 ]

    # period independent coefficients
    a2 = 0.0029
    a5 = 0.2529
    a6 = 7.5
    a7 = -0.5096
    c1 = 6.75
    c = 2.5
    n = 3.2
    Vcon = 1000.0
    Vref = 750.0

    # model has same functional form, but different coefficients for each distance metric
    # period-dependent coefficients
    if Rtype == "Rjb"
        a1 = [ 5.61201, 1.85329, 1.87032, 1.95279, 2.07006, 2.20452, 2.35413, 2.63078, 2.85412, 2.89772, 2.92748, 2.95162, 2.96299, 2.96622, 2.93166, 2.88988, 2.84627, 2.79778, 2.73872, 2.63479, 2.53886, 2.48747, 2.38739, 2.3015, 2.17298, 2.07474, 2.01953, 1.95078, 1.89372, 1.83717, 1.77528, 1.73155, 1.70132, 1.67127, 1.53838, 1.37505, 1.21156, 1.09262, 0.95211, 0.85227, 0.76564, 0.66856, 0.58739, 0.52349, 0.3768, 0.23251, 0.10481, 0.00887, -0.01867, -0.0996, -0.21166, -0.273, -0.35366, -0.42891, -0.55307, -0.67806, -0.80494, -0.91278, -1.05642, -1.17715, -1.22091, -1.34547, -1.3979, -1.37536 ]
        a3 = [ -0.0998, -0.02807, -0.0274, -0.02715, -0.02403, -0.01797, -0.01248, -0.00532, -0.00925, -0.01062, -0.01291, -0.01592, -0.01866, -0.02193, -0.02429, -0.02712, -0.03003, -0.033, -0.03462, -0.03789, -0.04173, -0.04768, -0.05178, -0.05672, -0.06015, -0.06508, -0.06974, -0.07346, -0.07684, -0.0801, -0.08296, -0.08623, -0.0907, -0.0949, -0.10275, -0.10747, -0.11262, -0.11835, -0.12347, -0.12678, -0.13133, -0.13551, -0.13957, -0.14345, -0.15051, -0.15527, -0.16106, -0.16654, -0.17187, -0.17728, -0.17908, -0.18438, -0.18741, -0.19029, -0.19683, -0.20339, -0.20703, -0.21074, -0.21392, -0.21361, -0.21951, -0.22724, -0.2318, -0.23848 ]
        a4 = [ -0.98388, -1.23452, -1.23698, -1.25363, -1.27525, -1.30123, -1.32632, -1.35722, -1.38182, -1.38345, -1.37997, -1.37627, -1.37155, -1.3646, -1.35074, -1.33454, -1.31959, -1.3045, -1.28877, -1.26125, -1.236, -1.21882, -1.19543, -1.17072, -1.13847, -1.11131, -1.09484, -1.07812, -1.0653, -1.05451, -1.04332, -1.03572, -1.02724, -1.01909, -0.99351, -0.96429, -0.93347, -0.91162, -0.88393, -0.86884, -0.85442, -0.83929, -0.82668, -0.81838, -0.79691, -0.77813, -0.75888, -0.74871, -0.75751, -0.74823, -0.73766, -0.72996, -0.72279, -0.72033, -0.71662, -0.70452, -0.69691, -0.6956, -0.69085, -0.67711, -0.68177, -0.65918, -0.65298, -0.66482 ]
        a8 = [ -0.0616, -0.1091, -0.1115, -0.104, -0.0973, -0.0884, -0.0853, -0.0779, -0.0749, -0.0704, -0.0604, -0.049, -0.0377, -0.0265, -0.0194, -0.0125, -0.0056, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        a9 = [ 0.063, 0.0937, 0.0953, 0.1029, 0.1148, 0.1073, 0.1052, 0.0837, 0.0761, 0.0707, 0.0653, 0.0617, 0.0581, 0.0545, 0.0509, 0.0507, 0.0502, 0.0497, 0.0493, 0.0488, 0.0483, 0.0478, 0.0474, 0.0469, 0.0464, 0.0459, 0.0459, 0.0429, 0.04, 0.0374, 0.0349, 0.0323, 0.0297, 0.0271, 0.0245, 0.0219, 0.0193, 0.0167, 0.0141, 0.0115, 0.0089, 0.0062, 0.0016, 0, 0, 0, 0, 0, 0, 0, 0, -0.003, -0.006, -0.009, -0.0141, -0.0284, -0.0408, -0.0534, -0.0683, -0.078, -0.0943, -0.1278, -0.1744, -0.2231 ]
        b1 = [ -0.72057, -0.41997, -0.41729, -0.39998, -0.34799, -0.27572, -0.21231, -0.14427, -0.27064, -0.31025, -0.34796, -0.39668, -0.43996, -0.48313, -0.52431, -0.5568, -0.58922, -0.62635, -0.65315, -0.68711, -0.72744, -0.77335, -0.80508, -0.82609, -0.8408, -0.86251, -0.87479, -0.88522, -0.89517, -0.90875, -0.91922, -0.9267, -0.9372, -0.94614, -0.96564, -0.98499, -0.99733, -1.00469, -1.00786, -1.00606, -1.01093, -1.01576, -1.01353, -1.01331, -1.0124, -1.00489, -0.98876, -0.9776, -0.98071, -0.96369, -0.94634, -0.93606, -0.91408, -0.91007, -0.89376, -0.87052, -0.85889, -0.86106, -0.85793, -0.82094, -0.84449, -0.83216, -0.79216, -0.75645 ]
        b2 = [ -0.19688, -0.28846, -0.28685, -0.28241, -0.26842, -0.24759, -0.22385, -0.17525, -0.29293, -0.31837, -0.3386, -0.36646, -0.38417, -0.39551, -0.40869, -0.41528, -0.42717, -0.4413, -0.44644, -0.44872, -0.46341, -0.48705, -0.47334, -0.4573, -0.44267, -0.43888, -0.4382, -0.43678, -0.43008, -0.4219, -0.40903, -0.39442, -0.38462, -0.37408, -0.35582, -0.34053, -0.30949, -0.28772, -0.28957, -0.28555, -0.28364, -0.28037, -0.2839, -0.28702, -0.27669, -0.27538, -0.25008, -0.23508, -0.24695, -0.2287, -0.21655, -0.20302, -0.18228, -0.17336, -0.15463, -0.13181, -0.14066, -0.13882, -0.13336, -0.1377, -0.15337, -0.10884, -0.08884, -0.07749 ]
        ϕi = [ 0.6014, 0.6201, 0.6215, 0.6266, 0.641, 0.6534, 0.6622, 0.6626, 0.667, 0.6712, 0.6768, 0.6789, 0.6822, 0.6796, 0.6762, 0.6723, 0.6694, 0.6647, 0.6645, 0.66, 0.6651, 0.665, 0.659, 0.6599, 0.6654, 0.6651, 0.6662, 0.6698, 0.6697, 0.6696, 0.6641, 0.6575, 0.654, 0.6512, 0.657, 0.663, 0.6652, 0.6696, 0.6744, 0.6716, 0.6713, 0.6738, 0.6767, 0.6787, 0.6912, 0.7015, 0.7017, 0.7141, 0.7164, 0.7198, 0.7226, 0.7241, 0.7266, 0.7254, 0.7207, 0.7144, 0.7122, 0.7129, 0.6997, 0.682, 0.6682, 0.6508, 0.6389, 0.6196 ]
        τi = [ 0.3311, 0.3501, 0.3526, 0.3555, 0.3565, 0.3484, 0.3551, 0.3759, 0.4067, 0.4059, 0.4022, 0.4017, 0.3945, 0.3893, 0.3928, 0.396, 0.396, 0.3932, 0.3842, 0.3887, 0.3792, 0.3754, 0.3757, 0.3816, 0.3866, 0.3881, 0.3924, 0.3945, 0.3962, 0.389, 0.3929, 0.4009, 0.4022, 0.4021, 0.4057, 0.406, 0.4124, 0.4135, 0.4043, 0.3974, 0.3971, 0.3986, 0.3949, 0.3943, 0.3806, 0.3802, 0.3803, 0.3766, 0.3799, 0.3817, 0.3724, 0.371, 0.3745, 0.3717, 0.3758, 0.3973, 0.4001, 0.4025, 0.4046, 0.4194, 0.3971, 0.4211, 0.415, 0.3566 ]
        σi = [ 0.6865, 0.7121, 0.7146, 0.7204, 0.7335, 0.7405, 0.7514, 0.7618, 0.7812, 0.7844, 0.7873, 0.7888, 0.7881, 0.7832, 0.782, 0.7803, 0.7778, 0.7723, 0.7676, 0.766, 0.7656, 0.7636, 0.7586, 0.7623, 0.7696, 0.7701, 0.7732, 0.7773, 0.7781, 0.7744, 0.7716, 0.7701, 0.7678, 0.7653, 0.7722, 0.7774, 0.7827, 0.787, 0.7863, 0.7804, 0.78, 0.7829, 0.7835, 0.7849, 0.7891, 0.7979, 0.7981, 0.8073, 0.8109, 0.8147, 0.8129, 0.8136, 0.8174, 0.8151, 0.8128, 0.8174, 0.8169, 0.8187, 0.8083, 0.8006, 0.7773, 0.7752, 0.7619, 0.7149 ]
    elseif Rtype == "Repi"
        a1 = [ 6.13498, 2.52977, 2.54832, 2.6442, 2.77723, 2.92666, 3.09355, 3.38462, 3.61906, 3.66537, 3.68544, 3.70155, 3.70871, 3.70477, 3.65565, 3.59764, 3.53732, 3.47722, 3.40112, 3.27214, 3.15842, 3.09498, 2.9809, 2.87449, 2.72364, 2.60904, 2.54266, 2.46615, 2.40119, 2.3454, 2.28213, 2.2344, 2.20123, 2.16953, 2.03012, 1.84644, 1.6676, 1.53432, 1.38296, 1.28662, 1.20114, 1.09991, 1.01256, 0.94162, 0.78017, 0.63219, 0.48905, 0.38492, 0.36315, 0.28812, 0.18172, 0.13021, 0.05074, -0.02806, -0.15016, -0.26608, -0.39025, -0.49742, -0.64241, -0.7667, -0.80566, -0.945, -0.98457, -0.93329 ]
        a3 = [ -0.12091, -0.05496, -0.05434, -0.05452, -0.05196, -0.04657, -0.04168, -0.03506, -0.03936, -0.04081, -0.04295, -0.04581, -0.04848, -0.05156, -0.0535, -0.05583, -0.0583, -0.0609, -0.0621, -0.06461, -0.06791, -0.07344, -0.07698, -0.08126, -0.08387, -0.08816, -0.09239, -0.09576, -0.09885, -0.10198, -0.10464, -0.10771, -0.11199, -0.11604, -0.12344, -0.12745, -0.13195, -0.13715, -0.14169, -0.14485, -0.14922, -0.1532, -0.157, -0.16069, -0.16727, -0.17174, -0.17712, -0.18237, -0.1879, -0.19363, -0.19545, -0.20069, -0.20386, -0.20666, -0.21319, -0.2196, -0.2233, -0.22716, -0.23038, -0.23049, -0.23726, -0.24437, -0.2493, -0.25756 ]
        a4 = [ -1.04013, -1.31001, -1.31268, -1.33135, -1.35509, -1.38259, -1.41008, -1.44268, -1.4687, -1.47079, -1.4652, -1.45986, -1.45433, -1.44613, -1.42989, -1.4111, -1.39329, -1.37648, -1.3577, -1.32624, -1.29833, -1.27945, -1.25442, -1.22665, -1.19143, -1.16231, -1.14444, -1.127, -1.11318, -1.10318, -1.09241, -1.08445, -1.07592, -1.06795, -1.04242, -1.01046, -0.97801, -0.95428, -0.92585, -0.91241, -0.89909, -0.88377, -0.8705, -0.86109, -0.83743, -0.81877, -0.79698, -0.78548, -0.79498, -0.78665, -0.77778, -0.77282, -0.76574, -0.7626, -0.75952, -0.75011, -0.74326, -0.74185, -0.73634, -0.72149, -0.72539, -0.70115, -0.69696, -0.7121 ]
        a8 = [ -0.0616, -0.1091, -0.1115, -0.104, -0.0973, -0.0884, -0.0853, -0.0779, -0.0749, -0.0704, -0.0604, -0.049, -0.0377, -0.0265, -0.0194, -0.0125, -0.0056, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        a9 = [ 0.063, 0.0937, 0.0953, 0.1029, 0.1148, 0.1073, 0.1052, 0.0837, 0.0761, 0.0707, 0.0653, 0.0617, 0.0581, 0.0545, 0.0509, 0.0507, 0.0502, 0.0497, 0.0493, 0.0488, 0.0483, 0.0478, 0.0474, 0.0469, 0.0464, 0.0459, 0.0459, 0.0429, 0.04, 0.0374, 0.0349, 0.0323, 0.0297, 0.0271, 0.0245, 0.0219, 0.0193, 0.0167, 0.0141, 0.0115, 0.0089, 0.0062, 0.0016, 0, 0, 0, 0, 0, 0, 0, 0, -0.003, -0.006, -0.009, -0.0141, -0.0284, -0.0408, -0.0534, -0.0683, -0.078, -0.0943, -0.1278, -0.1744, -0.2231 ]
        b1 = [ -0.72057, -0.41997, -0.41729, -0.39998, -0.34799, -0.27572, -0.21231, -0.14427, -0.27064, -0.31025, -0.34796, -0.39668, -0.43996, -0.48313, -0.52431, -0.5568, -0.58922, -0.62635, -0.65315, -0.68711, -0.72744, -0.77335, -0.80508, -0.82609, -0.8408, -0.86251, -0.87479, -0.88522, -0.89517, -0.90875, -0.91922, -0.9267, -0.9372, -0.94614, -0.96564, -0.98499, -0.99733, -1.00469, -1.00786, -1.00606, -1.01093, -1.01576, -1.01353, -1.01331, -1.0124, -1.00489, -0.98876, -0.9776, -0.98071, -0.96369, -0.94634, -0.93606, -0.91408, -0.91007, -0.89376, -0.87052, -0.85889, -0.86106, -0.85793, -0.82094, -0.84449, -0.83216, -0.79216, -0.75645 ]
        b2 = [ -0.19688, -0.28846, -0.28685, -0.28241, -0.26842, -0.24759, -0.22385, -0.17525, -0.29293, -0.31837, -0.3386, -0.36646, -0.38417, -0.39551, -0.40869, -0.41528, -0.42717, -0.4413, -0.44644, -0.44872, -0.46341, -0.48705, -0.47334, -0.4573, -0.44267, -0.43888, -0.4382, -0.43678, -0.43008, -0.4219, -0.40903, -0.39442, -0.38462, -0.37408, -0.35582, -0.34053, -0.30949, -0.28772, -0.28957, -0.28555, -0.28364, -0.28037, -0.2839, -0.28702, -0.27669, -0.27538, -0.25008, -0.23508, -0.24695, -0.2287, -0.21655, -0.20302, -0.18228, -0.17336, -0.15463, -0.13181, -0.14066, -0.13882, -0.13336, -0.1377, -0.15337, -0.10884, -0.08884, -0.07749 ]
        ϕi = [ 0.6143, 0.6375, 0.6389, 0.6434, 0.6569, 0.6693, 0.6773, 0.6791, 0.6851, 0.6884, 0.696, 0.6997, 0.7032, 0.7011, 0.6997, 0.697, 0.6956, 0.6915, 0.6922, 0.6893, 0.6942, 0.6938, 0.6877, 0.6897, 0.6947, 0.6939, 0.6945, 0.6971, 0.6971, 0.6955, 0.6891, 0.6825, 0.6785, 0.6751, 0.6788, 0.6845, 0.6857, 0.6902, 0.6937, 0.6884, 0.6866, 0.6881, 0.6904, 0.6922, 0.7047, 0.7138, 0.7137, 0.7263, 0.7287, 0.7307, 0.7322, 0.7316, 0.7341, 0.7333, 0.7277, 0.7199, 0.7171, 0.7175, 0.7051, 0.6876, 0.675, 0.6571, 0.6438, 0.6241 ]
        τi = [ 0.3485, 0.3581, 0.3607, 0.3615, 0.3617, 0.353, 0.3612, 0.3853, 0.416, 0.4163, 0.4118, 0.4102, 0.4028, 0.3978, 0.3989, 0.403, 0.4041, 0.4017, 0.3965, 0.4005, 0.3919, 0.3898, 0.3883, 0.3894, 0.3941, 0.3937, 0.3997, 0.4012, 0.4012, 0.3946, 0.3985, 0.4056, 0.4068, 0.4065, 0.4087, 0.4085, 0.4128, 0.4101, 0.4011, 0.3962, 0.3951, 0.3979, 0.3955, 0.3965, 0.3819, 0.3807, 0.3827, 0.3787, 0.3821, 0.3854, 0.3751, 0.3749, 0.3761, 0.3734, 0.3794, 0.4025, 0.4049, 0.409, 0.4115, 0.428, 0.4029, 0.4252, 0.4243, 0.3659 ]
        σi = [ 0.7063, 0.7312, 0.7337, 0.738, 0.7499, 0.7567, 0.7676, 0.7808, 0.8015, 0.8045, 0.8087, 0.8111, 0.8104, 0.8061, 0.8054, 0.8051, 0.8045, 0.7997, 0.7977, 0.7972, 0.7972, 0.7958, 0.7898, 0.792, 0.7987, 0.7978, 0.8013, 0.8043, 0.8043, 0.7996, 0.796, 0.7939, 0.7911, 0.788, 0.7923, 0.7971, 0.8004, 0.8028, 0.8013, 0.7943, 0.7922, 0.7949, 0.7957, 0.7977, 0.8015, 0.809, 0.8098, 0.8191, 0.8228, 0.8261, 0.8227, 0.8221, 0.8248, 0.8229, 0.8207, 0.8248, 0.8235, 0.8259, 0.8164, 0.8099, 0.7861, 0.7827, 0.771, 0.7235 ]
    elseif Rtype == "Rhyp"
        a1 = [ 6.72743, 3.26685, 3.28656, 3.38936, 3.53155, 3.68895, 3.86581, 4.18224, 4.4375, 4.48828, 4.51414, 4.5329, 4.53834, 4.52949, 4.47016, 4.40011, 4.33238, 4.26395, 4.1775, 4.03111, 3.90131, 3.82611, 3.6978, 3.57698, 3.40759, 3.2758, 3.19725, 3.11035, 3.03752, 2.97485, 2.90617, 2.85484, 2.8172, 2.77997, 2.62299, 2.42234, 2.2277, 2.08102, 1.91625, 1.81167, 1.71853, 1.60822, 1.51532, 1.43982, 1.26728, 1.11475, 0.95965, 0.85203, 0.83007, 0.74487, 0.63568, 0.56996, 0.485, 0.40614, 0.28608, 0.15432, 0.0225, -0.07822, -0.22534, -0.36165, -0.39423, -0.54126, -0.59607, -0.51893 ]
        a3 = [ -0.11474, -0.04846, -0.04784, -0.04796, -0.04537, -0.03991, -0.0349, -0.02826, -0.03256, -0.03407, -0.03635, -0.03929, -0.042, -0.04509, -0.04701, -0.04932, -0.05181, -0.05442, -0.05565, -0.05817, -0.06152, -0.06706, -0.0706, -0.0749, -0.07756, -0.08183, -0.08602, -0.08937, -0.09243, -0.09556, -0.09822, -0.10132, -0.1056, -0.10964, -0.11701, -0.12106, -0.12555, -0.13074, -0.13547, -0.13856, -0.14294, -0.14669, -0.15056, -0.15427, -0.16107, -0.1663, -0.1717, -0.17699, -0.18248, -0.18787, -0.18961, -0.19551, -0.19853, -0.20136, -0.20791, -0.2148, -0.21843, -0.22224, -0.22564, -0.22496, -0.23237, -0.24003, -0.24448, -0.25256 ]
        a4 = [ -1.17694, -1.47905, -1.48197, -1.50214, -1.52781, -1.55693, -1.58672, -1.62527, -1.65601, -1.65903, -1.6547, -1.64994, -1.64398, -1.63467, -1.61626, -1.59485, -1.57545, -1.55685, -1.53574, -1.50045, -1.46889, -1.44738, -1.41925, -1.38832, -1.34898, -1.31609, -1.29558, -1.27591, -1.26045, -1.24891, -1.237, -1.22822, -1.21874, -1.20953, -1.1801, -1.14424, -1.10853, -1.08192, -1.05027, -1.03514, -1.0201, -1.00315, -0.98859, -0.97812, -0.95163, -0.93048, -0.90604, -0.89379, -0.90319, -0.89323, -0.88392, -0.87459, -0.86659, -0.86343, -0.86086, -0.84778, -0.83937, -0.83964, -0.83314, -0.81702, -0.82109, -0.79431, -0.78785, -0.80922 ]
        a8 = [ -0.0616, -0.1091, -0.1115, -0.104, -0.0973, -0.0884, -0.0853, -0.0779, -0.0749, -0.0704, -0.0604, -0.049, -0.0377, -0.0265, -0.0194, -0.0125, -0.0056, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        a9 = [ 0.063, 0.0937, 0.0953, 0.1029, 0.1148, 0.1073, 0.1052, 0.0837, 0.0761, 0.0707, 0.0653, 0.0617, 0.0581, 0.0545, 0.0509, 0.0507, 0.0502, 0.0497, 0.0493, 0.0488, 0.0483, 0.0478, 0.0474, 0.0469, 0.0464, 0.0459, 0.0459, 0.0429, 0.04, 0.0374, 0.0349, 0.0323, 0.0297, 0.0271, 0.0245, 0.0219, 0.0193, 0.0167, 0.0141, 0.0115, 0.0089, 0.0062, 0.0016, 0, 0, 0, 0, 0, 0, 0, 0, -0.003, -0.006, -0.009, -0.0141, -0.0284, -0.0408, -0.0534, -0.0683, -0.078, -0.0943, -0.1278, -0.1744, -0.2231 ]
        b1 = [ -0.72057, -0.41997, -0.41729, -0.39998, -0.34799, -0.27572, -0.21231, -0.14427, -0.27064, -0.31025, -0.34796, -0.39668, -0.43996, -0.48313, -0.52431, -0.5568, -0.58922, -0.62635, -0.65315, -0.68711, -0.72744, -0.77335, -0.80508, -0.82609, -0.8408, -0.86251, -0.87479, -0.88522, -0.89517, -0.90875, -0.91922, -0.9267, -0.9372, -0.94614, -0.96564, -0.98499, -0.99733, -1.00469, -1.00786, -1.00606, -1.01093, -1.01576, -1.01353, -1.01331, -1.0124, -1.00489, -0.98876, -0.9776, -0.98071, -0.96369, -0.94634, -0.93606, -0.91408, -0.91007, -0.89376, -0.87052, -0.85889, -0.86106, -0.85793, -0.82094, -0.84449, -0.83216, -0.79216, -0.75645 ]
        b2 = [ -0.19688, -0.28846, -0.28685, -0.28241, -0.26842, -0.24759, -0.22385, -0.17525, -0.29293, -0.31837, -0.3386, -0.36646, -0.38417, -0.39551, -0.40869, -0.41528, -0.42717, -0.4413, -0.44644, -0.44872, -0.46341, -0.48705, -0.47334, -0.4573, -0.44267, -0.43888, -0.4382, -0.43678, -0.43008, -0.4219, -0.40903, -0.39442, -0.38462, -0.37408, -0.35582, -0.34053, -0.30949, -0.28772, -0.28957, -0.28555, -0.28364, -0.28037, -0.2839, -0.28702, -0.27669, -0.27538, -0.25008, -0.23508, -0.24695, -0.2287, -0.21655, -0.20302, -0.18228, -0.17336, -0.15463, -0.13181, -0.14066, -0.13882, -0.13336, -0.1377, -0.15337, -0.10884, -0.08884, -0.07749 ]
        ϕi = [ 0.628, 0.6475, 0.6492, 0.6543, 0.6685, 0.6816, 0.6899, 0.6881, 0.6936, 0.6965, 0.7022, 0.7043, 0.7071, 0.7048, 0.7032, 0.7011, 0.6992, 0.6947, 0.6954, 0.6925, 0.6973, 0.6973, 0.6914, 0.6934, 0.6992, 0.699, 0.7006, 0.7036, 0.7037, 0.7023, 0.6956, 0.6893, 0.6852, 0.6821, 0.6866, 0.6926, 0.6949, 0.6993, 0.7028, 0.6981, 0.6959, 0.6983, 0.7006, 0.7022, 0.7137, 0.7224, 0.7226, 0.7349, 0.7378, 0.7406, 0.7418, 0.7431, 0.7457, 0.7446, 0.7391, 0.7311, 0.7281, 0.7279, 0.7154, 0.6984, 0.6867, 0.6687, 0.6565, 0.6364 ]
        τi = [ 0.3312, 0.3472, 0.3481, 0.3508, 0.3526, 0.3513, 0.3659, 0.3942, 0.4122, 0.4065, 0.3964, 0.3937, 0.3853, 0.3779, 0.3851, 0.39, 0.3889, 0.3903, 0.3848, 0.3891, 0.3839, 0.3839, 0.3865, 0.3896, 0.3908, 0.3888, 0.3916, 0.3913, 0.3894, 0.3847, 0.3908, 0.3986, 0.4017, 0.4017, 0.4044, 0.4005, 0.3981, 0.3967, 0.389, 0.3824, 0.3831, 0.3825, 0.3797, 0.3826, 0.3721, 0.3723, 0.3746, 0.3697, 0.3758, 0.3794, 0.3686, 0.3692, 0.3705, 0.3676, 0.3718, 0.3941, 0.3967, 0.3987, 0.4019, 0.4113, 0.38, 0.4009, 0.3952, 0.3318 ]
        σi = [ 0.71, 0.7347, 0.7366, 0.7424, 0.7558, 0.7668, 0.7809, 0.793, 0.8068, 0.8064, 0.8064, 0.8069, 0.8053, 0.7997, 0.8017, 0.8023, 0.8001, 0.7968, 0.7948, 0.7943, 0.796, 0.796, 0.7921, 0.7954, 0.801, 0.7999, 0.8026, 0.8051, 0.8043, 0.8008, 0.7979, 0.7963, 0.7943, 0.7916, 0.7968, 0.8001, 0.8009, 0.804, 0.8033, 0.796, 0.7944, 0.7962, 0.7969, 0.7997, 0.8049, 0.8127, 0.8139, 0.8227, 0.828, 0.8321, 0.8283, 0.8298, 0.8327, 0.8304, 0.8273, 0.8306, 0.8292, 0.8299, 0.8206, 0.8105, 0.7848, 0.7797, 0.7663, 0.7177 ]
    else
        print("PJS Error: Rtype must be one of 'Rjb', 'Repi' or 'Rhyp'")
        return PJSgroundMotion()
    end

    # check bounds on the allowable value of T
    if T < 0.0 # PGV requested
        tidHI = tidLO = 1
    else
        # limit the period range (note that coefficients for PGA and 0.01s are not equal)
        T = (T > 4.0) ? 4.0 : T
        tidHI = findfirst(Ti .>= T)
        tidLO = findlast(Ti .<= T)
    end

    if tidHI == tidLO
        # we have a known period
		tid = tidHI

		# reference amplitude
		if M <= c1
			lnSaRef = a1[tid] + a2*(M-c1) + a3[tid]*(8.5-M)^2 + (a4[tid] + a5*(M-c1))*log(sqrt( R^2 + a6^2 )) + a8[tid]*Fnm + a9[tid]*Frv
		else
			lnSaRef = a1[tid] + a7*(M-c1) + a3[tid]*(8.5-M)^2 + (a4[tid] + a5*(M-c1))*log(sqrt( R^2 + a6^2 )) + a8[tid]*Fnm + a9[tid]*Frv
		end

		# site resposne
		if Vs30 <= Vref
			# need to compute reference PGA
			pga_ref = PJSasb2014pga(M, R, Fnm, Frv, Rtype)
			lnS = b1[tid] * log( Vs30/Vref ) + b2[tid] * log( ( pga_ref + c*(Vs30/Vref)^n )/((pga_ref + c)*(Vs30/Vref)^n) )
		else
			lnS = b1[tid] * log( min(Vs30, Vcon)/ Vref )
		end

		lnSa = lnSaRef + lnS
		Sa = exp(lnSa)

		τ = τi[tid]
		ϕ = ϕi[tid]
		σ = σi[tid]
    else
        # we need to interpolate
        @inbounds TiLO = Ti[tidLO]
        @inbounds TiHI = Ti[tidHI]

        if T < 0.01
            # assume that PGA coefficients are really at 0.001s
            Tfrac = log(max(T,0.001)/0.001)/log(TiHI/0.001)
        else
            Tfrac = log(T/TiLO)/log(TiHI/TiLO)
        end

        asbLO = PJSasb2014( TiLO, M, R, Vs30, Fnm, Frv, Rtype )
        asbHI = PJSasb2014( TiHI, M, R, Vs30, Fnm, Frv, Rtype )

        lnSa = asbLO.lnIM + Tfrac*(asbHI.lnIM-asbLO.lnIM)
        Sa = exp(lnSa)

        τ = asbLO.τ + Tfrac*(asbHI.τ - asbLO.τ)
		ϕ = asbLO.ϕ + Tfrac*(asbHI.ϕ - asbLO.ϕ)
		σ = asbLO.σ + Tfrac*(asbHI.σ - asbLO.σ)
    end

    gm = PJSgroundMotion(Sa, lnSa, τ, ϕ, σ)
	return gm
end


function PJSasb2014( Ti::Vector{U}, M::U, R::U, Vs30::U, Fnm::Int64, Frv::Int64, Rtype::String="Rjb") where U<:Real
	predictions = Array{PJSgroundMotion,1}()
	for T in Ti
		push!(predictions, PJSasb2014(T, M, R, Vs30, Fnm, Frv, Rtype))
	end
	return predictions
end


function PJSasb2014(T::U, rup::Rupture{U}, site::Site{U}, Rtype::String="Rjb") where U<:Real
	if Rtype == "Rjb"
		R = joyner_boore_distance(rup, site)
	elseif Rtype == "Repi"
		R = epicentral_distance(rup, site)
	elseif Rtype == "Rhyp"
		R = hypocentral_distance(rup, site)
	end
	Fss, Fnm, Frv, Fuk = mechanism(rup)
	gm = PJSasb2014(T, rup.magnitude, R, vs30(site), Fnm, Frv, Rtype)
	return gm
end


function PJSasb2014(Ti::Vector{U}, rup::Rupture{U}, site::Site{U}, Rtype::String="Rjb") where U<:Real
	predictions = Array{PJSgroundMotion,1}()
	for T in Ti
		push!(predictions, PJSasb2014(T, rup, site, Rtype))
	end
	return predictions
end
